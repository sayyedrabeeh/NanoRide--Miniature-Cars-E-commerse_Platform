{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Showroom Transactions | AutoGallery</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Poppins -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
        <link rel="icon" type="image/png" href="{% static 'images/fav.jpg' %}">

    <style>
        :root {
            --bg-dark: #0a0a0a;
            --bg-card: #141414;
            --accent-gold: #d4af37;
            --accent-red: #e63946;
            --accent-green: #2ecc71;
            --text-main: #ffffff;
            --text-muted: #a0a0a0;
            --border-color: #262626;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* --- Page Header --- */
        .orders-header {
            background: linear-gradient(rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0.85)), url('https://images.unsplash.com/photo-1549237511-6b64e0aa8bab?auto=format&fit=crop&q=80&w=1920');
            background-size: cover;
            background-position: center;
            padding: 100px 0 60px;
            border-bottom: 1px solid var(--border-color);
        }

        .orders-header h1 {
            font-size: 3.5rem;
            font-weight: 800;
            letter-spacing: -1px;
            margin-bottom: 15px;
        }

        .orders-header p {
            color: var(--accent-gold);
            font-weight: 500;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        /* --- Breadcrumb --- */
        .breadcrumb-nav {
            background: #000;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .breadcrumb-item a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.85rem;
            transition: var(--transition);
        }

        .breadcrumb-item a:hover {
            color: var(--accent-gold);
        }

        .breadcrumb-item.active {
            color: var(--accent-gold);
            font-weight: 500;
        }

        .breadcrumb-item+.breadcrumb-item::before {
            color: var(--border-color);
        }

        /* --- Container --- */
        .orders-container {
            padding: 80px 0;
        }

        /* --- Order List Card --- */
        .order-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .order-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent-gold);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .order-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .meta-item {
            display: flex;
            flex-direction: column;
        }

        .meta-label {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .meta-value {
            font-size: 1rem;
            font-weight: 600;
        }

        .status-badge {
            font-size: 0.7rem;
            font-weight: 800;
            padding: 5px 15px;
            border-radius: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-success {
            background: rgba(46, 204, 113, 0.1);
            color: var(--accent-green);
            border: 1px solid var(--accent-green);
        }

        .status-pending {
            background: rgba(212, 175, 55, 0.1);
            color: var(--accent-gold);
            border: 1px solid var(--accent-gold);
        }

        .status-failure {
            background: rgba(230, 57, 70, 0.1);
            color: var(--accent-red);
            border: 1px solid var(--accent-red);
        }

        /* --- Order Items --- */
        .order-items-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .ordered-item {
            display: flex;
            align-items: center;
            gap: 20px;
            background: #000;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #1a1a1a;
        }

        .item-thumb {
            width: 80px;
            height: 80px;
            object-fit: contain;
            background: #0a0a0a;
            border-radius: 6px;
            padding: 5px;
        }

        .item-info {
            flex-grow: 1;
        }

        .item-brand {
            color: var(--accent-gold);
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            margin-bottom: 3px;
            display: block;
        }

        .item-name {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 5px;
        }

        .item-specs {
            color: var(--text-muted);
            font-size: 0.8rem;
        }

        .item-total {
            text-align: right;
        }

        .item-price {
            font-size: 1.1rem;
            font-weight: 800;
            display: block;
        }

        .item-qty {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* --- Actions --- */
        .btn-action {
            background: transparent;
            border: 1px solid var(--border-color);
            color: #fff;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            transition: var(--transition);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .btn-action:hover {
            background: var(--border-color);
            color: #fff;
            border-color: var(--accent-gold);
        }

        .btn-primary-gold {
            background: var(--accent-gold);
            color: #000;
            border-color: var(--accent-gold);
        }

        .btn-primary-gold:hover {
            background: #fff;
            border-color: #fff;
            color: #000;
            transform: translateY(-2px);
        }

        .btn-cancel {
            color: var(--accent-red);
            border-color: rgba(230, 57, 70, 0.3);
        }

        .btn-cancel:hover {
            background: var(--accent-red);
            color: #fff;
            border-color: var(--accent-red);
        }

        .btn-return {
            color: var(--accent-green);
            border-color: rgba(46, 204, 113, 0.3);
        }

        .btn-return:hover {
            background: var(--accent-green);
            color: #fff;
            border-color: var(--accent-green);
        }

        /* --- Detail View --- */
        .order-detail-view {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 40px;
        }

        .detail-section {
            margin-bottom: 40px;
        }

        .detail-title {
            font-size: 1.4rem;
            font-weight: 800;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 15px;
        }

        /* --- Tracking Timeline --- */
        .tracking-timeline {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin: 40px 0 60px;
        }

        .tracking-timeline::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--border-color);
            z-index: 1;
        }

        .timeline-step {
            position: relative;
            z-index: 2;
            text-align: center;
            width: 20%;
        }

        .timeline-icon {
            width: 32px;
            height: 32px;
            background: var(--bg-dark);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: var(--text-muted);
            transition: var(--transition);
        }

        .timeline-step.active .timeline-icon {
            background: var(--accent-gold);
            border-color: var(--accent-gold);
            color: #000;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.5);
        }

        .timeline-step.completed .timeline-icon {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: #fff;
        }

        .timeline-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-muted);
        }

        .timeline-step.active .timeline-label {
            color: #fff;
        }

        /* --- Payment Banner --- */
        .payment-banner {
            border-radius: 8px;
            padding: 15px 25px;
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .banner-success {
            background: rgba(46, 204, 113, 0.1);
            border: 1px solid var(--accent-green);
            color: var(--accent-green);
        }

        .banner-pending {
            background: rgba(212, 175, 55, 0.1);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
        }

        .banner-failure {
            background: rgba(230, 57, 70, 0.1);
            border: 1px solid var(--accent-red);
            color: var(--accent-red);
        }

        /* --- Summary Grid --- */
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 0.95rem;
        }

        .summary-total {
            font-size: 1.5rem;
            font-weight: 800;
            border-top: 2px solid var(--border-color);
            margin-top: 15px;
            padding-top: 15px;
        }

        /* --- Modals --- */
        .modal-content {
            background: var(--bg-card);
            color: #fff;
            border: 1px solid var(--accent-gold);
        }

        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
        }

        .btn-close {
            filter: invert(1);
        }

        /* --- Empty State --- */
        .empty-orders {
            text-align: center;
            padding: 100px 0;
        }

        .empty-icon {
            font-size: 6rem;
            color: #1a1a1a;
            margin-bottom: 30px;
        }

        .btn-explore {
            background: var(--accent-gold);
            color: #000;
            padding: 15px 40px;
            border-radius: 6px;
            font-weight: 700;
            text-transform: uppercase;
            transition: var(--transition);
            display: inline-block;
            text-decoration: none;
        }

        .btn-explore:hover {
            background: #fff;
            transform: translateY(-3px);
        }

        /* --- Footer --- */
        footer {
            background: #000;
            padding: 80px 0 40px;
            border-top: 1px solid var(--border-color);
        }

        .footer-logo {
            font-size: 1.8rem;
            font-weight: 900;
            color: #fff;
            margin-bottom: 25px;
        }

        .footer-logo span {
            color: var(--accent-gold);
        }

        @media (max-width: 768px) {
            .orders-header h1 {
                font-size: 2.5rem;
            }

            .order-meta {
                gap: 15px;
            }

            .ordered-item {
                flex-direction: column;
                align-items: flex-start;
            }

            .item-total {
                text-align: left;
            }

            .tracking-timeline {
                flex-wrap: wrap;
                gap: 20px;
            }

            .timeline-step {
                width: 45%;
            }

            .tracking-timeline::before {
                display: none;
            }
        }
    </style>
</head>

<body>

    <!-- Page Header -->
    <header class="orders-header">
        <div class="container text-center">
            <h1>My Orders</h1>
            <p>Your Archive of High-Performance Miniatures</p>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="breadcrumb-nav">
        <div class="container">
            <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a href="{% url 'products:home' %}">Home</a></li>
                <li class="breadcrumb-item"><a href="/profile/profile/">My Account</a></li>
                <li class="breadcrumb-item active">Order History</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="orders-container container">

        {% if selected_order %}
        <!-- --- ORDER DETAIL VIEW --- -->
        <div class="order-detail-view">
            <div class="d-flex justify-content-between align-items-center mb-5 flex-wrap gap-3">
                <div>
                    <h2 class="mb-1">Order #{{ selected_order.tracking_number }}</h2>
                    <span class="text-muted">Placed on {{ selected_order.created_at|date:"F d, Y at H:i" }}</span>
                </div>
                <div class="d-flex gap-3">
                    <a href="{% url 'order:download_invoice' selected_order.order_id %}" class="btn-action">
                        <i class="fas fa-file-invoice"></i> Export Invoice
                    </a>
                    <a href="/profile/profile/" class="btn-action">
                        <i class="fas fa-arrow-left"></i> Return to List
                    </a>
                </div>
            </div>

            <!-- Payment Status Banner -->
            <div
                class="payment-banner {% if selected_order.payment == 'Success' %}banner-success{% elif selected_order.payment == 'pending' %}banner-pending{% else %}banner-failure{% endif %}">
                <i
                    class="fas {% if selected_order.payment == 'Success' %}fa-check-circle{% elif selected_order.payment == 'pending' %}fa-clock{% else %}fa-exclamation-triangle{% endif %} fs-4"></i>
                <div class="flex-grow-1">
                    <span class="fw-bold">Payment Status: {{ selected_order.payment|title }}</span>
                    {% if selected_order.payment == 'Failure' %}
                    <p class="mb-0 small">There was an issue processing your transaction. Please try again.</p>
                    {% endif %}
                </div>
                {% if selected_order.payment == 'Failure' %}
                <button id="retry-payment" class="btn-gold btn-sm">RETRY PAYMENT</button>
                {% endif %}
            </div>

            <!-- Tracking Segment -->
            <div class="detail-section">
                <h3 class="detail-title">Acquisition Progress</h3>
                <div class="tracking-timeline">
                    <div class="timeline-step completed">
                        <div class="timeline-icon"><i class="fas fa-check"></i></div>
                        <span class="timeline-label">Ordered</span>
                    </div>
                    <div class="timeline-step active">
                        <div class="timeline-icon"><i class="fas fa-box"></i></div>
                        <span class="timeline-label">Processing</span>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-icon"><i class="fas fa-truck"></i></div>
                        <span class="timeline-label">Shipped</span>
                    </div>
                    <div class="timeline-step">
                        <div class="timeline-icon"><i class="fas fa-home"></i></div>
                        <span class="timeline-label">Delivered</span>
                    </div>
                </div>
            </div>

            <div class="row g-5">
                <!-- Items Section -->
                <div class="col-lg-8">
                    <div class="detail-section">
                        <h3 class="detail-title">Manifest</h3>
                        <div class="order-items-grid">
                            {% for item in order_items %}
                            <div class="ordered-item">
                                {% if item.product.additional_images.exists %}
                                <img src="{{ item.product.additional_images.first.image.url }}" class="item-thumb"
                                    alt="Model">
                                {% else %}
                                <img src="{% static 'images/default.jpg' %}" class="item-thumb" alt="Model">
                                {% endif %}

                                <div class="item-info">
                                    <span class="item-brand">{{ item.product.category.brand_name }}</span>
                                    <h5 class="item-name">{{ item.product.name }}</h5>
                                    <span class="item-specs">Scale: 1:18 | Size: {{ item.size }}</span>
                                </div>

                                <div class="item-total">
                                    <span class="item-price">₹{{ item.price }}</span>
                                    <span class="item-qty">Qty: {{ item.quantity }}</span>
                                </div>

                                <div class="ms-lg-3">
                                    <span
                                        class="status-badge {% if item.status == 'Delivered' %}status-success{% elif item.status == 'Cancelled' %}status-failure{% else %}status-pending{% endif %} mb-2 d-block text-center">
                                        {{ item.status }}
                                    </span>

                                    {% if item.status == 'Delivered' %}
                                    <button class="btn-action btn-return w-100" data-bs-toggle="modal"
                                        data-bs-target="#returnModal-{{ item.orderitem_id }}">
                                        Return Item
                                    </button>
                                    {% elif item.status != 'Cancelled' and item.status != 'Requested Return' and item.status != 'Returned' %}
                                    <button class="btn-action btn-cancel w-100" data-bs-toggle="modal"
                                        data-bs-target="#cancelModal-{{ item.orderitem_id }}">
                                        Cancel Item
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <!-- Summary Section -->
                <div class="col-lg-4">
                    <div class="detail-section">
                        <h3 class="detail-title">Audit Summary</h3>
                        <div class="summary-card bg-black p-4 rounded-3 border border-secondary border-opacity-25">
                            <div class="summary-row">
                                <span class="text-muted">Subtotal ({{ order_items|length }} Items)</span>
                                <span>₹{{ selected_order.total_price }}</span>
                            </div>
                            {% if cupon_discount > 0 %}
                            <div class="summary-row">
                                <span class="text-muted">Coupon Discount</span>
                                <span class="text-gold">- ₹{{ cupon_discount }}</span>
                            </div>
                            {% endif %}
                            <div class="summary-row">
                                <span class="text-muted">Secure Shipping</span>
                                <span class="text-success">FREE</span>
                            </div>
                            <div class="summary-row summary-total">
                                <span>Final Value</span>
                                <span class="text-gold">₹{{ selected_order.total_price }}</span>
                            </div>
                            <button class="btn-primary-gold w-100 mt-4 py-3">Support Ticket</button>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3 class="detail-title">Dispatch Address</h3>
                        <div class="address-preview p-4 rounded-3 border border-secondary border-opacity-25">
                            <p class="mb-0 text-muted small">
                                {{ selected_order.shipping_address.full_address|default:"Premium Shipping Protocol Enabled" }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% elif orders %}
        
        <div class="orders-list">
            <div class="d-flex justify-content-between align-items-center mb-5 flex-wrap gap-4">
                <h2 class="mb-0 fw-bold">Transaction History</h2>
                <div class="d-flex gap-3">
                    <div class="input-group" style="max-width: 300px;">
                        <span class="input-group-text bg-black border-secondary border-opacity-25 text-muted"><i
                                class="fas fa-search"></i></span>
                        <input type="text" class="form-control bg-black border-secondary border-opacity-25 text-white"
                            placeholder="Order ID or Model...">
                    </div>
                </div>
            </div>

            {% for order in orders %}
            {% if order.items.all %}
            <div class="order-card">
                <div class="order-meta">
                    <div class="meta-item">
                        <span class="meta-label">Tracking Number</span>
                        <span class="meta-value">#{{ order.tracking_number }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Date Placed</span>
                        <span class="meta-value">{{ order.created_at|date:"M d, Y" }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Total Value</span>
                        <span class="meta-value text-gold">₹{{ order.total_price }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Payment</span>
                        <span
                            class="status-badge {% if order.payment == 'Success' %}status-success{% elif order.payment == 'pending' %}status-pending{% else %}status-failure{% endif %}">
                            {{ order.payment }}
                        </span>
                    </div>
                    <div class="ms-md-auto align-self-center">
                        <a href="{% url 'order:order_with_order' order_id=order.order_id %}"
                            class="btn-action btn-primary-gold">
                            Review Details <i class="fas fa-chevron-right ms-2"></i>
                        </a>
                    </div>
                </div>

                <div class="row align-items-center">
                    <div class="col-md-8">
                        <div class="d-flex gap-3">
                            {% for item in order.items.all|slice:":4" %}
                            {% if item.product.additional_images.exists %}
                            <img src="{{ item.product.additional_images.first.image.url }}" class="item-thumb"
                                alt="Item" style="width: 50px; height: 50px;">
                            {% endif %}
                            {% endfor %}
                            {% if order.items.count > 4 %}
                            <div class="item-thumb d-flex align-items-center justify-content-center text-muted small"
                                style="width: 50px; height: 50px;">+{{ order.items.count|add:"-4" }}</div>
                            {% endif %}
                            <div class="align-self-center">
                                <span class="text-muted small">{{ order.items.count }} high-end model{{order.items.count|pluralize }} included in this acquisition.</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-md-end">
                        <span class="text-muted small"><i class="fas fa-shipping-fast me-2"></i> Shipped via Premium
                            Dispatch</span>
                    </div>
                </div>
            </div>
            {% endif %}
            {% endfor %}

            <!-- Pagination -->
            {% if orders.has_other_pages %}
            <div class="pagination-controls d-flex justify-content-center mt-5">
                <nav>
                    <ul class="pagination bg-transparent border-0 gap-2">
                        {% if orders.has_previous %}
                        <li class="page-item"><a class="btn-action" href="?page={{ orders.previous_page_number }}"><i
                                    class="fas fa-chevron-left"></i></a></li>
                        {% endif %}
                        <li class="page-item"><span class="btn-action active">{{ orders.number }} of {{
                                orders.paginator.num_pages }}</span></li>
                        {% if orders.has_next %}
                        <li class="page-item"><a class="btn-action" href="?page={{ orders.next_page_number }}"><i
                                    class="fas fa-chevron-right"></i></a></li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
            {% endif %}
        </div>
        {% else %}
        <!-- --- EMPTY STATE --- -->
        <div class="empty-orders">
            <div class="empty-icon"><i class="fas fa-history"></i></div>
            <h2>Your Showroom is Awaiting Arrivals</h2>
            <p class="text-muted mb-5">You haven't added any high-performance miniatures to your collection yet.</p>
            <a href="{% url 'products:products' %}" class="btn-explore">Explore Current Catalog</a>
        </div>
        {% endif %}

    </main>

    <!-- Modals -->
    {% for item in order_items %}
    <!-- Cancel Modal -->
    <div class="modal fade" id="cancelModal-{{ item.orderitem_id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Authorize Cancellation</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" action="{% url 'order:update_orderitem_status' orderitem_id=item.orderitem_id %}">
                    {% csrf_token %}
                    <input type="hidden" name="status" value="Cancelled">
                    <div class="modal-body">
                        <p>Are you certain you wish to remove <strong>{{ item.product.name }}</strong> from this order?
                            This action is permanent.</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Maintain
                            Order</button>
                        <button type="submit" class="btn-gold btn-sm bg-danger border-danger text-white">Confirm
                            Cancellation</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Return Modal -->
    <div class="modal fade" id="returnModal-{{ item.orderitem_id }}" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Initiate Product Return</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <form method="POST" action="{% url 'order:update_orderitem_status' orderitem_id=item.orderitem_id %}">
                    {% csrf_token %}
                    <input type="hidden" name="status" value="Requested Return">
                    <div class="modal-body">
                        <p>Are you requesting a return for <strong>{{ item.product.name }}</strong>? Our collectors'
                            satisfaction is our priority.</p>
                        <div class="mb-3">
                            <label class="meta-label">Protocol for Return</label>
                            <select class="form-select bg-black border-secondary border-opacity-25 text-white">
                                <option>Model damage during transit</option>
                                <option>Incorrect scale delivered</option>
                                <option>Not as described in gallery</option>
                                <option>Other / Change of mind</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Keep
                            Model</button>
                        <button type="submit" class="btn-gold btn-sm bg-success border-success text-white">Confirm
                            Return Request</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    <!-- Trust Strip -->
    <section class="container mb-5">
        <div class="row g-4 text-center">
            <div class="col-6 col-md-3">
                <i class="fas fa-shield-alt text-gold mb-3 fs-3"></i>
                <h6 class="fw-bold mb-1">Encrypted Checkout</h6>
                <p class="text-muted small">Banking-grade security</p>
            </div>
            <div class="col-6 col-md-3">
                <i class="fas fa-certificate text-gold mb-3 fs-3"></i>
                <h6 class="fw-bold mb-1">Authentic Licensed</h6>
                <p class="text-muted small">Certified masterworks</p>
            </div>
            <div class="col-6 col-md-3">
                <i class="fas fa-box-open text-gold mb-3 fs-3"></i>
                <h6 class="fw-bold mb-1">Collector Packaging</h6>
                <p class="text-muted small">Safeguarded for travel</p>
            </div>
            <div class="col-6 col-md-3">
                <i class="fas fa-globe text-gold mb-3 fs-3"></i>
                <h6 class="fw-bold mb-1">Global Dispatch</h6>
                <p class="text-muted small">Worldwide collectors' reach</p>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container text-center">
            <div class="footer-logo">NANORIDE<span>.</span></div>
            <p class="text-muted small">The definitive destination for high-end automotive miniatures and rare
                collectible scale models.</p>
            <div class="d-flex justify-content-center gap-3 mt-4">
                <a href="#" class="text-muted"><i class="fab fa-instagram"></i></a>
                <a href="#" class="text-muted"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="text-muted"><i class="fab fa-twitter"></i></a>
            </div>
            <div class="text-muted small mt-4 pt-4 border-top border-secondary">
                &copy; 2026 NanoRide Collectibles. Curated for the Discerning Enthusiast.
            </div>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    {% if selected_order and selected_order.payment == 'Failure' %}
    <script>
        var retryOptions = {
            "key": "{{ razorpay_key }}",
            "amount": "{{ total_price_in_paise }}",
            "currency": "INR",
            "order_id": "{{ razorpay_order_id }}",
            "handler": function (response) {
                window.location.href = "{% url 'cart:success_page' %}?order_id={{ order_id }}";
            },
            "prefill": {
                "name": "{{ user.username }}",
                "email": "{{ user.email }}"
            },
            "theme": { "color": "#d4af37" }
        };

        const retryBtn = document.getElementById('retry-payment');
        if (retryBtn) {
            retryBtn.onclick = function (e) {
                var rzpRetry = new Razorpay(retryOptions);
                rzpRetry.open();
                e.preventDefault();
            };
        }
    </script>
    {% endif %}
</body>

</html>